Course Table (User Guide)
==========================
新版 PKU Helper 4 iOS 客户端中的课程表模块是对原版的完全重写。下面对其主要特征及相关设置项进行介绍：


表头与侧栏
------------
表头和侧栏均可以通过单击展开/关闭，表头展开后会额外显示当天日期，侧栏展开后会额外显示每节课的上课时间。

#### 相关的设置项

- 默认展开表头 (Weekday header expanded by default)： 打开课程表时默认自动展开表头，默认值 `true`
- 默认展开侧栏 (Side column expanded by default)： 打开课程表时默认自动展开侧栏，默认值 `false`


课程列
------------
新版课程表中，点击具体一门课，不再会弹框显示课程的详细信息，而是会展开/恢复该课程所在星期的一整列课程，默认展开当天的课程列。这个设计借鉴自 [HutHelper](https://github.com/isnine/HutHelper)。如果你需要查看课程的详细信息，可以查看 `自定义课程 (Custom courses)` 的列表。

#### 相关的设置项

- 课程列可展开 (Course column expandable)： 课程列是否可以单击展开，默认值 `true`
- 默认展开当日课程列 (Today's column expanded by default)： 在课程列可展开的前提下，打开课程表时默认自动展开当日的课程列，默认值 `true`


课程表配色
----------------
新版的课程表通过一个简单的染色算法来分配每个课程在课表中显示的背景色，它能实现以下的效果：

- 相同的课程（课名相同）采用相同的背景色
- 相邻的不同课程背景色不同
- 输入的课表数据源相同时，染色结果相同
- 对课程表数据源进行部分修改时，非相邻课程的染色受到的影响较小

新版课程表允许自行选择可以被用于分配的背景色。建议提供至少 **5 个** 可选的颜色，以确保染色算法可以得出满足前两点要求的方案。当颜色池过小，不能得出符合条件的解时，该算法会给出一个折中的染色方案（部分相邻课程的染色存在冲突），并弹框提示最小的可满足方案的颜色数量。

#### 相关的设置项

- 课程网格背景色池 (Cell color pool)： 可以被用于分配的背景色
- 课表网格文字颜色 (Cell text color)： 课表网格内的文字前景色，默认 `Material Gray 100 (#F5F5F5)`
- 不提示颜色池大小 (Disable color pool size alert)： 当染色算法无法给出满足前两点要求的方案时，不弹出提示框
- 用户随机种子 (User random seed)： 一个可以影响每个课程背景色选择的优先顺序的参数，修改后可以改变整个课程表背景色的随机分配结果。默认值为 `0`


隐藏课程
------------
新版课程表允许你隐藏部分课程。这些课程将不被显示在课程表中。可通过导航栏菜单项中的 `自定义课程 (Custom courses)` 项进行设置。


冲突课程
------------
新版课程表采用了与原版课程表完全不同的布局实现，现在表格的任意一个时间段上，都可以重叠任意多门课，但是最终只能看到显示在最上方的课，位于下方的课会被覆盖遮挡。你可以通过隐藏部分冲突课程，来控制冲突课程的正确显示。


当周不上的课程
--------------
新版课程表借鉴了旧版的设计，当周不上的课会以单独的样式显示出来。这些课程的背景色配色独立于前述的 [课程表配色](#课程表配色) ，所采用的颜色不会与前述的背景色池发生冲突（即使色值相同）。

#### 当周不上的课至少包括：

- 仅单周上的课，当前双周
- 仅双周上的课，当前单周
- 并非 1-16 周都需要上的课，例如仅 1-8 周上的课，当前第 8 周之后
- 在 1-16 周每周都上的课，当前为 17-18 考试周
- 学期内的所有课程，当前假期周 (week 0)

#### 相关的设置项

- 隐藏其他周的课程 (Hide other week's classes)： 课程表会直接隐藏当周不上的课程，而不是采用单独的样式显示出来。
- 其他周课程的背景色 (Color for other weeks' classes)： 统一对当周不上的课程填充该背景色，默认值 `Material Gray 300 (#E0E0E0)`


标准开学时间
-------------
新版 PKU Helper 客户端会通过请求服务器来动态获取开学时间。服务器会返回一个标准的开学时间，它与北大本部本科生的开学时间一致。新版客户端每隔一段时间会自动重新请求服务器以更新标准的开学时间
。
#### 相关的设置项

- 立即刷新标准开学时间 (Refresh standard semester beginning)： 立即手动刷新一次标准开学时间


自定义开学时间
-------------
标准的开学时间只能满足北大本部本科生的需求，并不能满足北大医学部学生的需求。北医的开学时间往往比北大本部要早，不能共用本部的开学时间。为了让非北大本部的学生也能够正常使用 PKU Helper 的课程表，新版客户端允许用户自定义开学时间，具体的操作方法如下：

1. 打开 `使用自定义开学时间 (Use Custom Semester Beginning)` 项
2. 修改 `自定义的开学时间 (Custom Semester Beginning)` 项，将其拨到相应的日期

注：新版客户端中，设置的开学日期等价于当周的星期一（遵循中国人对一周的认知习惯），也就是说，`2019-09-09`, `2019-09-11`, `2019-09-15`是等价的，它们在程序中均被认为是 `2019-09-09` ，而 `2019-09-08` 将被认为是 `2019-09-02`


重构的课程数据模型
------------------
新版的课程表采用的课程数据模型存在着以下的变化：

- 原版的课程表定义一个课程只能有一个上课地点，新版的课程表允许一个课程的每节课都拥有不同的上课地点。
- 原版的课程表只能指定 `每周`, `单周`, `双周` 三种情况，新版的课程表除了这三种情况外，还允许指定为特殊的周次： `第 1 周` 至 `第 16 周` 上课周，`第 17 周` 和 `第 18 周` 考试周，`第 0 周` 假期时间。这些周次具体指哪几天，需要由当前设定的开学时间来定义。其中，`第 0 周` 是一个特殊的周次，它的含义是 **非第 1-18 周** ，用来表示假期时间，其长度不定，并非 7 天。
- 可以准确描述并非整学期 1-16 周都上的课（例如仅 1-8 周上的课），它们将被存储为等价的相应具体周次课程的组合。


获取官方课程表
---------------
在导航栏菜单项中，点击 `从 ISOP 获取课程 (Fetch from ISOP)`，可以获取 [北大 ISOP 平台](https://isop.pku.edu.cn) 提供的个人官方课程表。这部分课程相当于一批 **自定义课程** 。


添加/修改自定义课程
------------------
在导航栏菜单项中，进入 `自定义课程 (Custom courses)` 页，点击右上角的加号，可以添加自定义课程。点击每一个课程旁的编辑按钮，可以对当前课程进行修改。


云端同步
---------------
新版 PKU Helper 服务器为每一位用户提供了课表的云存储功能，上传到云端的课表可以被其他接入新版服务器的客户端所下载，从而可以实现课程备份、多终端同步。相关操作均定义在导航栏菜单项中：

- 你可以在 `自定义课程 (Custom courses)` 项中上传/同步相应的课程
- 你可以在 `管理云端 (Manage cloud)` 项中查看当前云端存储的课程，并可以从云端删除课程
- 你可以点击 `从云端获取 (Fetch from cloud)` 项将当前云端存储的所有课程下载到本地。


课程导出到日历
---------------
新版课程表同样支持将课程导出到日历的功能，你可以通过点击导航栏菜单栏中的 `导出到日历 (Export to calendar)` 项导出课程。之后你可以在 `管理日历 (Manage calendar)` 页删除部分/全部的课程表日历事件（当然你也可以直接在 Calendar App 中删除与 PKU Helper 课程表相关的任何日历/事件）。

与原版课程表不同的是：

- 对于每周/单周/双周重复的课，新版课程表会将它们拆分成等价的具体周次的课来存储（不包含考试周/假期时间）。也就是说，一个每周都会上的课，会被存为从第 1 周至第 16 周分别发生的 16 个事件，而不是 1 个每周都会发生的事件。这样的设计是为了消除不同周次间课程的关系，以方便对发生在某个特定周的上课事件进行单独地修改。
- 在将课程导入到日历前，会首先渲染出一个待导入事件的列表，你可以手动删除部分事件，然后再执行导入操作。

注：隐藏的课程默认也会被导入到日历，如果你不需要这些课程，请先将它们从自定义课程中删除，或者在导入日历时手动删掉已隐藏课程所对应的事件。
